---
 
copyright:
  years: 2021, 2022
lastupdated: "2022-11-17"

subcollection: code-risk-analyzer-cli-plugin

keywords: code risk analyzer, cli, code risk analyzer command line, code risk analyzer terminal, code risk analyzer shell, Terraform analysis, bill of materials, cra, code risk analyzer, plug-in

---

{{site.data.keyword.attribute-definition-list}}

# Code Risk Analyzer plug-in for {{site.data.keyword.cloud_notm}}
{: #cra-cli-plugin}

The {{site.data.keyword.cloud}} command-line interface (CLI) provides code risk analysis commands. You can use the {{site.data.keyword.cloud_notm}} CLI to analyze your code for vulnerabilities and compliance with certain rules. Code Risk Analyzer is available in all {{site.data.keyword.cloud_notm}} regions where toolchains are supported.
{: shortdesc}

You can use the CLI to complete the following tasks:

* Generate a Bill of Materials (BOM) file that lists the dependencies and available license information of all third-party OS packages and application packages. You can also generate this output in CycloneDX-specific format.
* Discover vulnerabilities in packages that are listed in the BOM file. You can also view the generated report in CycloneDX-specific format.
* Analyze a Terraform plan for compliance with certain rules.
* Analyze Kubernetes files for compliance with certain rules.

## Supported content
{: #cra-supported-content}

Code Risk Analyzer supports the Java&trade;, Node.js, Python, and Go languages. The following table lists and describes the content that Code Risk Analyzer supports.

|Content |Description	|
|:----------|:------------------------------|
|Java		|The repo must use Maven or Gradle. For Maven, dependencies are computed by using the `pom.xml` file. For Gradle, dependencies are computed by using the `Build.gradle` file.		|
|Node.js		|Dependencies are computed by using the `package-lock.json` file.		|
|Python		|Dependencies are computed by using the `requirements.txt` file.		|
|Golang		|Supports `go mod` and `go dep` dependency management. For `go mod`, the `go.sum` file must be in the repo. For `go dep`, the `Gopkg.lock` file must be in the repo.		|
| Dockerfiles		|Files with the `Dockerfile` pattern in the repo are considered. For container images, the Debian, Red Hat Enterprise Linux&reg;, Alpine, and Ubuntu Linux distros are supported.  		|
| Kubernetes		|Files that are suffixed with `.yaml` and `.yml` are considered. The `kind` value must be set to `Pod`, `ReplicaSet`, `ReplicationController`, `Deployment`, `Daemonset`, `Statefulset`, `Job`, or `CronJob`.   		|
|Terraform		|The Terraform plan file must be generated by using {{site.data.keyword.cloud_notm}} as the Terraform provider.		|
{: caption="Table 1. Supported content" caption-side="top"}

## Known issues with Code Risk Analyzer
{: #cra-known-issues}

Code Risk Analyzer cannot discover vulnerabilities on application packages that do not use a versioning scheme, such as `major.minor.patch`. For example, pre-release versions or versions that contain build metadata are not supported. 

## Prerequisites
{: #prerequisites}

* Install the {{site.data.keyword.cloud_notm}} CLI. See [Download {{site.data.keyword.cloud_notm}} CLI](https://cloud.ibm.com/docs/cli?topic=cli-getting-started) for instructions.

* Install the Code Risk Analyzer CLI plug-in by running the following command:

```sh
ibmcloud plugin install cra 
```

* Make sure that you can access a toolchain in one of the supported regions. The toolchain is not required to have any tools. For more information about toolchains, see [Creating a toolchain from an app](/docs/ContinuousDelivery?topic=ContinuousDelivery-toolchains_getting_started#creating_a_toolchain_from_an_app).

* Specify the toolchain ID by setting the `TOOLCHAIN_ID` environment variable:

```sh
export TOOLCHAIN_ID=e22195a5-11e3-44ba-9533-e7c18a3a61a7
```

* Log in to a specific region of {{site.data.keyword.cloud_notm}} by running the following command, where `[region]` is the region where the toolchain was created.
  
```sh
ibmcloud login -r [region]
```

## CLI usage commands
{: #CLI-usage-commands}

You receive notifications on the command line when updates to the {{site.data.keyword.cloud_notm}} CLI and plug-ins are available. Make sure that you keep your CLI current so that you can use the latest commands. You can view the current version of all of the installed plug-ins by running the `ibmcloud plugin list` command.
{: tip}

### Code Risk Analyzer help
{: #cra-help}

The following command displays the list of Code Risk Analyzer commands:

```sh
ibmcloud cra --help
```

### Code Risk Analyzer command help
{: #cra-command-help}

The following command displays the details of flags that are used with a command. Use `ibmcloud cra --help` to display the available commands.

```sh
ibmcloud cra <command> --help
```

## Bill of Materials (BOM)
{: #bom-generate-command}

The `bom-generate` command accesses artifacts in the specified directory path and performs deep discovery to identify all of the dependencies, including transitive dependencies. The command also identifies the licenses that these dependencies are distributed under. A BOM file is created that captures a snapshot of all of the dependencies. You can generate this BOM file in the standard format or in CycloneDX's SBOM format.

```sh
ibmcloud cra bom-generate
```

### BOM command requirements
{: #bom-requirements}

The `bom-generate` command depends on certain external commands:

* If the path contains Dockerfiles, this command pulls down base images and build images for every build stage in each Dockerfile. In this scenario, the `bom-generate` command requires that the `Docker cli` and `tar` commands are available.
* If the path contains Maven files, this command uses `mvn` to build a list of dependencies. In this scenario, the `bom-generate` command requires the `mvn` command to be available.
* If the path contains Gradle files, this command uses `gradle` to build a list of dependencies. In this scenario, the `bom-generate` command requires the `gradle` command to be available.
* If the path contains Node.js `pacakge-json` files and this command is used to generate a corresponding `package-lock.json` file, the `bom-generate` command uses `npm` to build the package-lock.json file. In this scenario, the command requires the `npm` command to be available.
* If the path contains the Python requirements.txt file, the command uses `pip` to generate the package dependencies. In this scenario, the `bom-generate`command requires the `pip` command to be available. Both Python version 2 and Python version 3 are supported. 

If you are using Dockerfiles, make sure to log in to your container registry from where the base images are to be pulled. 

If your Dockerfile requires ARGS, set an individual ARG as an environment variable before you run the command.  For example, if the Dockerfile is using an `IAM_USER` ARG, export an environment variable that is named `IAM_USER`: `export IAM_USER='value'`. The CLI automatically passes these environment variables to the `docker build` command.  

You can also specify the `DOCKERBUILDFLAGS` flag explicitly. To export `DOCKERBUILDFLAGS` with the ARGS Docker flag, type the following command:

```sh
export DOCKERBUILDFLAGS="--build-arg IAM_USER --build-arg API_KEY"
```

### BOM command options 
{: #bom-options}

The following table lists the command options that you can use to generate a BOM file with the `bom-generate` command. 

| Command Options                        | Required or Optional | Description                                                                                                                                                                                                                                              |
| -------------------------------------- | -------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `--path`                               | Required             | The project directory path to scan.                                                                                                                                                                                                                      |
| `-r`, `--report`                       | Required             | The file name in which to store the BOM report.                                                                                                                                                                                                          |
| `-a`, `--asset-type`                   | Optional             | The security checks to run (apps, image, os, all). By default, this option is set to `all`. The `apps` option is used to limit discovery to application packages.  The `image` option is used to limit discovery to base images that are used in Dockerfiles. The `os` option is used to limit discovery to build stages in Dockerfiles only. You can specify multiple values by using a comma to delimit the values, such as `-a os,image,apps`.                                                                                                                                                                                |
| `-p`, `--prev-report`                  | Optional             | Use the previous BOM report to speed up the command. For example, if a Dockerfile was not updated since the last report was generated, the command skips the discovery of packages from that Dockerfile. The same scenario applies to other manifest files such as the `package-lock.json` file.                                                                                                                                                                                |
| `-c`, `--dockerbuildcontext`           | Optional             | If specified, CRA uses the directory in the path parameter as the Docker build context during build stage scanning. |
| `-o`, `--output`                       | Optional             | Select the BOM report format. You can generate the format output in either Standard BOM format (`standard`) or CycloneDX's SBOM format (`cyclonedx`). The default value is `standard`. You can store both formats by inputting each format separated by a comma with no space. |
| `-f`, `--dockerbuildflags`             | Optional             | Customize the Docker build command for build stage scanning. Instead of using this command-line flag, you can specify the value in an environment variable named `DOCKERBUILDFLAGS`. By default, this command option is set to `''`. If you use this option, make sure that it is the last flag that is provided to the command. |
| `-d`, `--dockerfilepattern`            | Optional             | The pattern to identify the Dockerfile in the repo.  |
| `-g`, `--gradle.excludeconfigurations` | Optional             | Exclude the Gradle configurations, for example: `runtimeClasspath,testCompileClasspath`. By default, this command option is set to `''`.                                                                                                                                |
| `-l`, `--gradleprops` | Optional             | Customize the Gradle command with properties for Gradle dependency scanning. |                                                                                                                                |
| `-m`, `--maven.excludescopes`          | Optional             | Exclude the Maven scopes, for example: `test,compile`. Example: 'test,compile'. By default, this command option is set to `''`.                                                                                                                                         |
| `-n`, `--nodejs.createpackagelock`     | Optional             | Enable the task to build the package-lock.json file for node.js projects.                                                                                                                                                                                |
| `--region`                             | Optional             | The `ibmcloud` region where the toolchain is located.                                                      |
|  `--toolchainid`                       | Optional             | The target toolchain ID to use.                                                      |
| `-v`, `--verbose`                      | Optional             | Enable verbose log messages.                                                                                                                                                                                                                             |
{: caption="Table 2. Command options for generating a BOM file" caption-side="top"}

### Ignoring files
{: #ignore-files}

If the path contains the `.cra/.fileignore` file, files that are specified in the `.fileignore` file are not scanned for dependencies. The `.fileignore` file must follow the rules of [`.gitignore` files](https://git-scm.com/docs/gitignore){: external}. Similar to a `.gitignore` file, the `.fileignore` file can include comments, directories to ignore, files to ignore, and other [patterns](https://git-scm.com/docs/gitignore#_pattern_format){: external}.

The following example `.fileignore` file shows how to exclude bash scripts, node_modules, and the Dockerfile.

```text
# Ignore nested functional_tests directory
**/functional_tests

# Ignore bash scripts
**/*.sh

# This should allow this one file
!test/gatling_tests/loginTobx.sh

# Ignore node_modules
node_modules

# Exclude the dockerfile from scanning
Dockerfile
```
 
### Example
{: #bom-example}

The following code snippets show how to use the `bom-generate` command:

```sh
ibmcloud cra bom-generate --path PATH --report REPORT [--asset-type ASSET-TYPE] [--dockerbuildcontext] [--dockerbuildflags DOCKERBUILDFLAGS] [--dockerfilepattern DOCKERFILEPATTERN] [--gradle.excludeconfigurations GRADLE.EXCLUDECONFIGURATIONS] [--maven.excludescopes MAVEN.EXCLUDESCOPES] [--nodejs.createpackagelock] [--prev-report PREV-REPORT] [--region REGION] [--toolchainid TOOLCHAINID] [--verbose]
```

```sh
ibmcloud cra bom --path . --report bomreport.json
```

## Vulnerability scan
{: #vulnerability-command}

The `vulnerability-scan` command expects a BOM file in `standard` format as input and detects vulnerabilities in application packages and OS packages that are listed in the BOM file. Based on rich threat intelligence from Snyk, targeted fix recommendations are provided. You can also generate this report in the standard format or in CycloneDX's Vulnerability Exploitability Exchange (VEX) format.

```sh
ibmcloud cra vulnerability-scan
```

### Vulnerability scan command options 
{: #vulnerability-options}

The following table lists the options for using the `vulnerability-scan` command. 

| Command Options      | Required or Optional | Description                                                                |
| -------------------- | -------------------- | -------------------------------------------------------------------------- |
| `-b`, `--bom`        | Required             | The file path of the BOM file that was generated by using the `bom-generate` command. This BOM file must be in `standard` format.                               |
| `-c`, `--cveignore`  | Required             | The file path of the CVE Ignore file that contains the list of CVEs to ignore.                                      |
| `-e`, `--excludedev` | Optional             | Specifies that you do not want the command to report CVEs for development dependencies.                                     |
| `--include-nofix`    | Optional             | Include or exclude the reporting of CVEs that do not have known remediations. By default, this option is set to `app`. The `app` option is used to include only app package CVEs with no fixes. The `os` option is used to include only OS package CVEs with no fixes. The `all` option is used to include both app and OS package CVEs with no fixes. The `none` option is used to exclude both app and OS package CVEs with no fixes. |
| `-r`, `--report`     | Optional             | The path to the generated report.                                          |
| `-o`, `--output`     | Optional             | Selects the CVE report format. You can generate the format output in either Standard CVE format (`standard`) or CycloneDX's VEX format (`cyclonedx`). The default value is `standard`. |
| `-s`, `--strict`     | Optional             | Results in command failure (exit status 2) when vulnerabilities are found. |
{: caption="Table 3. Command options for performing a vulnerability scan" caption-side="top"}

### Ignoring vulnerabilities
{: #cra-omit-vulnerabilities}

If the `-c` or `--cveignore` parameter is specified, the command looks for that file and does not report the CVEs that are specified in the file. You can configure the CVEs to omit them indefinitely until a remediation is available, or until a specified expiration date.

The following example shows a JSON schema for the `.cveignore` file:

```json
[
    {
        "cve": "string",
	    "alwaysOmit": "bool",
	    "untilRemediationAvailable": "bool",
	    "expiration": "string"
    }
]
```

The following properties are supported for each entry in the `.cveignore` file:

* **cve** - The vulnerability to omit. The value of this property is either a CVE ID or a Snyk ID.
* **alwaysOmit** - If this property is set to `true`, the vulnerability is omitted until it is changed. This property takes precedence over other property values.
* **untilRemediationAvailable** - If this property is set to `true`, the vulnerability is omitted  until a remediation path is available. If a remediation becomes available, the vulnerability is not omitted and a message is displayed. This property takes precedence over the expiration property value.
* **expiration** - If this property is set to `true` and the expiration date is not reached, the vulnerability is omitted. If the expiration date is reached, the vulnerability is not omitted and a message is displayed. Use the RFC3339 time format (`yyyy-MM-ddTHH:mm:ss[+-]Z`) to define this property.
 
The Code Risk Analyzer uses only these defined properties. You can add properties with no effect on functions. If a vulnerability that is defined in the `.cveignore` is not omitted, a log is generated that explains the reason. If a vulnerability that is defined in the `.cveignore` file is omitted, no individual logging is displayed. The number of omissions and a list of the vulnerability IDs, with the package name, that are omitted are logged after a report is completed.

The following code snippet shows a sample `.cveignore` file:

```json
[
    {
        "cve": "CVE-2021-27290",
        "alwaysOmit": true
    },
    {
        "cve": "CVE-2020-8244",
        "untilRemediationAvailable": true,
    },
    {
        "cve": "SNYK-JAVA-ORGAPACHEHTTPCOMPONENTS-31517",
        "expiration": "2022-02-10T22:08:41+04:00",
        "comment": "Additional security measures are in place"
    }
]
```

### Example
{: #vulnerability-example}

The following code snippets show how to use the `vulnerability-scan` command:

```sh
ibmcloud cra vulnerability-scan --bom BOM [--cveignore CVEIGNORE] [--report REPORT] [--excludedev] [--include-nofix app,os,all,none] [--region REGION] [--strict] [--toolchainid TOOLCHAINID] [--output OUTPUTFILE]
```

```sh
ibmcloud cra cve --bom ./bom-file.json --cveignore ./cveignore-example.json --report ./output-vulnerability-report.json --excludedev --include-nofix all --strict
```

## Deployment
{: #deployment-command}

The `deployment-analyze` command runs configuration checks on Kubernetes deployment manifests.

```sh
ibmcloud cra deployment-analyze
```

This command provides prescriptive guidance for establishing a secure configuration posture for Docker containers. The Code Risk Analyzer uses these security configurations as a point of reference and identifies security controls to check in deployment artifacts, such as `.yaml` files, for Kubernetes applications. This command also provides risk assessments for each control failure.

The following table lists the controls that you can implement within DevSecOps, as identified from CIS Docker 1.13.0. More controls are added based on open source references of the [Kubernetes Common Configuration Scoring System (KCCSS)](https://github.com/octarinesec/kccss){: external}.


|ID | Rule | Risk |
|---------|---------|:----------:|
| 5.3| Ensure that containers do not have the `CAP_SYS_ADMIN` capability. | High|
| 5.3| Ensure that containers do not have the `CAP_NET_RAW` capability. | High|
| 5.4| Ensure that privileged containers are not used. | High|
| 5.5| Ensure that sensitive host system directories are not mounted on containers. | Medium|
| 5.7| Ensure that privileged ports are not mapped within containers. | Low|
| 5.9| Ensure that the host's network namespace is not shared. | Medium|
| 5.10| Ensure that the memory usage for the container is limited. | Medium|
| 5.11| Ensure that the appropriate CPU priority is set on the container. | Medium|
| 5.12| Ensure that the container's root file system is mounted as read-only. | Medium|
| 5.15| Ensure that the host's process namespace is not shared. | Medium|
| 5.16| Ensure that the host's IPC namespace is not shared. | Medium|
| 5.31| Ensure that the Docker socket is not mounted inside any containers. | High|
| -| Ensure that containers do not allow unsafe allocation of CPU resources. | Medium|
| -| Ensure that containers do not allow privilege escalation. | Medium|
| -| Ensure that containers do not expose unsafe parts of `/proc`. | Medium|
| -| Ensure that containers are not exposed through a shared host port. | Medium|
{: caption="Table 4. Security controls" caption-side="top"}

### Deployment command options 
{: #deployment-options}

The following table lists the command options that you can use for the `deployment-analyze` command. 

| Command Options      | Required or Optional | Description                                                                         |
| -------------------- | -------------------- | ----------------------------------------------------------------------------------- |
| `--path`             | Required             | The project directory path to scan.                                                 |
| `-r`, `--report`     | Required             | The file name in which to create the report.                                        |
| `-f`, `--fileignore` | Optional             | The file path of the `.fileignore` file.                                            |
| `-s`, `--strict`     | Optional             | The results of the command failure (exit status 2) when deployment risks are found. |
{: caption="Table 5. Command options for deployment analysis." caption-side="top"}

### Example
{: #deployment-example}

The following code snippets show how to use the `deployment-analyze` command:

```sh
ibmcloud cra deployment-analyze --path PATH --report REPORT [--fileignore FILE_IGNORE] [--strict]
```

```sh
ibmcloud cra depl --path ./sampleDir --report deployment-report.json --strict
```

## Terraform Analyzer
{: #terraform-command}

You can use the `terraform-validate` command to analyze a Terraform plan for compliance before applying the plan to an environment. This command analyzes the specified Terraform Plan file for compliance with goals that are specified in the IBM Security and Compliance Center (SCC). This command generates a compliance report. 

You can specify a policy file that lists the goals and parameters to use for validation. If no policy file is specified, this command analyzes the plan for the default set of goals.

```sh
ibmcloud cra terraform-validate
```

### Terraform command options 
{: #terraform-options}

The following table lists the options that you can use for the `terraform-validate` command. 

| Command Options       | Required or Optional | Description                                                                                                                               |
| --------------------- | -------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| `-r`, `--report`      | Required             | The path to the generated report.                                                                                                         |
| `-t`, `--tf-plan`     | Required             | The path to the input Terraform plan file.                                                                                                      |
| `-p`, `--policy-file` | Optional             | The path to the policy profile file. This file must contain `scc_goals` and `scc_goal_parameters` that overwrite default SCC values. The policy profile JSON file can also contain comments without quoted values. The file can also contain the `.jsonc` file extension for JSON profiles with comments. |
| `-q`, `--quiet`       | Optional             | Displays only summarized information.                                                                                                     |
| `-s`, `--strict`      | Optional             | Results in command failure (exit status 2) if policies fail.                                                                              |
| `-v`, `--verbose`     | Optional             | Displays the list of passing SCC Goals after the list of failed SCC goals.                                                                |
{: caption="Table 6. Command options for performing Terraform analysis." caption-side="top"}

### Example
{: #terraform-example}

The following code snippets show how to use the `terraform-validate` command:

```sh
ibmcloud cra terraform-validate --tf-plan TFPLANFILE --report REPORT [--policy-file POLICYFILE] [--strict] [--quiet] [--verbose]
```

```sh
ibmcloud cra tf -r report-user-rofile.json -t ./tfplan.json  -p ./user-profile.json --verbose
```

#### Example Terraform plan file for the `terraform-validate` command
{: #terraform-example-validate}

```text
{
    "format_version": "0.2",
    "terraform_version": "1.0.2",
    "planned_values": {
        "root_module": {
            "child_modules": [
                {
                    "resources": [
                        {
                            "address": "module.instance.ibm_resource_instance.cos_instance",
                            "mode": "managed",
                            "type": "ibm_resource_instance",
                            "name": "cos_instance",
                            "provider_name": "registry.terraform.io/ibm-cloud/ibm",
                            "schema_version": 0,
                            "values": {
                                "location": "global",
                                "parameters": null,
                                "plan": "lite",
                                "service": "cloud-object-storage",
                                "timeouts": null
                            },
                            "sensitive_values": {
                                "extensions": {},
                                "last_operation": {},
                                "plan_history": [],
                                "tags": []
                            }
                        }
                    ],
                    "address": "module.instance"
                },
                {
                    "resources": [
                        {
                            "address": "module.instance_config.ibm_cos_bucket.bad_resource_cos_bucket_missing_all_configuration[0]",
                            "mode": "managed",
                            "type": "ibm_cos_bucket",
                            "name": "bad_resource_cos_bucket_missing_all_configuration",
                            "index": 0,
                            "provider_name": "registry.terraform.io/ibm-cloud/ibm",
                            "schema_version": 0,
                            "values": {
                                "activity_tracking": [],
                                "allowed_ip": null,
                                "archive_rule": [],
                                "cross_region_location": null,
                                "endpoint_type": "public",
                                "expire_rule": [],
                                "force_delete": true,
                                "key_protect": null,
                                "metrics_monitoring": [],
                                "region_location": "us-south",
                                "retention_rule": [],
                                "single_site_location": null,
                                "storage_class": "standard",
                                "timeouts": null
                            },
                            "sensitive_values": {
                                "activity_tracking": [],
                                "archive_rule": [],
                                "expire_rule": [],
                                "metrics_monitoring": [],
                                "retention_rule": []
                            }
                        },
                        {
                            "address": "module.instance_config.ibm_cos_bucket.bad_resource_cos_bucket_missing_all_configuration[1]",
                            "mode": "managed",
                            "type": "ibm_cos_bucket",
                            "name": "bad_resource_cos_bucket_missing_all_configuration",
                            "index": 1,
                            "provider_name": "registry.terraform.io/ibm-cloud/ibm",
                            "schema_version": 0,
                            "values": {
                                "activity_tracking": [],
                                "allowed_ip": null,
                                "archive_rule": [],
                                "cross_region_location": null,
                                "endpoint_type": "public",
                                "expire_rule": [],
                                "force_delete": true,
                                "key_protect": null,
                                "metrics_monitoring": [],
                                "region_location": "us-south",
                                "retention_rule": [],
                                "single_site_location": null,
                                "storage_class": "standard",
                                "timeouts": null
                            },
                            "sensitive_values": {
                                "activity_tracking": [],
                                "archive_rule": [],
                                "expire_rule": [],
                                "metrics_monitoring": [],
                                "retention_rule": []
                            }
                        }
                    ],
                    "address": "module.instance_config"
                }
            ]
        }
    },
    "resource_changes": [
        {
            "address": "module.instance.ibm_resource_instance.cos_instance",
            "module_address": "module.instance",
            "mode": "managed",
            "type": "ibm_resource_instance",
            "name": "cos_instance",
            "provider_name": "registry.terraform.io/ibm-cloud/ibm",
            "change": {
                "actions": [
                    "create"
                ],
                "before": null,
                "after": {
                    "location": "global",
                    "parameters": null,
                    "plan": "lite",
                    "service": "cloud-object-storage",
                    "timeouts": null
                },
                "after_unknown": {
                    "account_id": true,
                    "allow_cleanup": true,
                    "created_at": true,
                    "created_by": true,
                    "crn": true,
                    "dashboard_url": true,
                    "deleted_at": true,
                    "deleted_by": true,
                    "extensions": true,
                    "guid": true,
                    "id": true,
                    "last_operation": true,
                    "locked": true,
                    "name": true,
                    "plan_history": true,
                    "resource_aliases_url": true,
                    "resource_bindings_url": true,
                    "resource_controller_url": true,
                    "resource_crn": true,
                    "resource_group_crn": true,
                    "resource_group_id": true,
                    "resource_group_name": true,
                    "resource_id": true,
                    "resource_keys_url": true,
                    "resource_name": true,
                    "resource_plan_id": true,
                    "resource_status": true,
                    "restored_at": true,
                    "restored_by": true,
                    "scheduled_reclaim_at": true,
                    "scheduled_reclaim_by": true,
                    "service_endpoints": true,
                    "state": true,
                    "status": true,
                    "sub_type": true,
                    "tags": true,
                    "target_crn": true,
                    "type": true,
                    "update_at": true,
                    "update_by": true
                },
                "before_sensitive": false,
                "after_sensitive": {
                    "extensions": {},
                    "last_operation": {},
                    "plan_history": [],
                    "tags": []
                }
            }
        },
        {
            "address": "module.instance_config.ibm_cos_bucket.bad_resource_cos_bucket_missing_all_configuration[0]",
            "module_address": "module.instance_config",
            "mode": "managed",
            "type": "ibm_cos_bucket",
            "name": "bad_resource_cos_bucket_missing_all_configuration",
            "index": 0,
            "provider_name": "registry.terraform.io/ibm-cloud/ibm",
            "change": {
                "actions": [
                    "create"
                ],
                "before": null,
                "after": {
                    "activity_tracking": [],
                    "allowed_ip": null,
                    "archive_rule": [],
                    "cross_region_location": null,
                    "endpoint_type": "public",
                    "expire_rule": [],
                    "force_delete": true,
                    "key_protect": null,
                    "metrics_monitoring": [],
                    "region_location": "us-south",
                    "retention_rule": [],
                    "single_site_location": null,
                    "storage_class": "standard",
                    "timeouts": null
                },
                "after_unknown": {
                    "activity_tracking": [],
                    "archive_rule": [],
                    "bucket_name": true,
                    "crn": true,
                    "expire_rule": [],
                    "id": true,
                    "metrics_monitoring": [],
                    "resource_instance_id": true,
                    "retention_rule": [],
                    "s3_endpoint_private": true,
                    "s3_endpoint_public": true
                },
                "before_sensitive": false,
                "after_sensitive": {
                    "activity_tracking": [],
                    "archive_rule": [],
                    "expire_rule": [],
                    "metrics_monitoring": [],
                    "retention_rule": []
                }
            }
        },
        {
            "address": "module.instance_config.ibm_cos_bucket.bad_resource_cos_bucket_missing_all_configuration[1]",
            "module_address": "module.instance_config",
            "mode": "managed",
            "type": "ibm_cos_bucket",
            "name": "bad_resource_cos_bucket_missing_all_configuration",
            "index": 1,
            "provider_name": "registry.terraform.io/ibm-cloud/ibm",
            "change": {
                "actions": [
                    "create"
                ],
                "before": null,
                "after": {
                    "activity_tracking": [],
                    "allowed_ip": null,
                    "archive_rule": [],
                    "cross_region_location": null,
                    "endpoint_type": "public",
                    "expire_rule": [],
                    "force_delete": true,
                    "key_protect": null,
                    "metrics_monitoring": [],
                    "region_location": "us-south",
                    "retention_rule": [],
                    "single_site_location": null,
                    "storage_class": "standard",
                    "timeouts": null
                },
                "after_unknown": {
                    "activity_tracking": [],
                    "archive_rule": [],
                    "bucket_name": true,
                    "crn": true,
                    "expire_rule": [],
                    "id": true,
                    "metrics_monitoring": [],
                    "resource_instance_id": true,
                    "retention_rule": [],
                    "s3_endpoint_private": true,
                    "s3_endpoint_public": true
                },
                "before_sensitive": false,
                "after_sensitive": {
                    "activity_tracking": [],
                    "archive_rule": [],
                    "expire_rule": [],
                    "metrics_monitoring": [],
                    "retention_rule": []
                }
            }
        }
    ],
    "configuration": {
        "provider_config": {
            "ibm": {
                "name": "ibm",
                "version_constraint": "1.25.0",
                "expressions": {
                    "ibmcloud_api_key": {
                        "constant_value": "BYwB2M3TJdDMlCpHaxaWilNHVod05TVkqjIbGqrlm9Iz"
                    }
                }
            },
            "module.instance:ibm": {
                "name": "ibm",
                "version_constraint": "1.25.0",
                "module_address": "module.instance",
                "expressions": {
                    "ibmcloud_api_key": {
                        "constant_value": "BYwB2M3TJdDMlCpHaxaWilNHVod05TVkqjIbGqrlm9Iz"
                    }
                }
            },
            "module.instance_config:ibm": {
                "name": "ibm",
                "version_constraint": "1.25.0",
                "module_address": "module.instance_config"
            }
        },
        "root_module": {
            "module_calls": {
                "instance": {
                    "source": "./instance_module",
                    "module": {
                        "outputs": {
                            "cos_instance_id": {
                                "expression": {
                                    "references": [
                                        "ibm_resource_instance.cos_instance.id",
                                        "ibm_resource_instance.cos_instance"
                                    ]
                                }
                            }
                        },
                        "resources": [
                            {
                                "address": "ibm_resource_instance.cos_instance",
                                "mode": "managed",
                                "type": "ibm_resource_instance",
                                "name": "cos_instance",
                                "provider_config_key": "instance:ibm",
                                "expressions": {
                                    "location": {
                                        "constant_value": "global"
                                    },
                                    "name": {},
                                    "plan": {
                                        "constant_value": "lite"
                                    },
                                    "service": {
                                        "constant_value": "cloud-object-storage"
                                    }
                                },
                                "schema_version": 0
                            }
                        ]
                    }
                },
                "instance_config": {
                    "source": "./instance_config_module",
                    "expressions": {
                        "cos_instance_id": {
                            "references": [
                                "module.instance.cos_instance_id",
                                "module.instance"
                            ]
                        }
                    },
                    "module": {
                        "resources": [
                            {
                                "address": "ibm_cos_bucket.bad_resource_cos_bucket_missing_all_configuration",
                                "mode": "managed",
                                "type": "ibm_cos_bucket",
                                "name": "bad_resource_cos_bucket_missing_all_configuration",
                                "provider_config_key": "instance_config:ibm",
                                "expressions": {
                                    "bucket_name": {},
                                    "region_location": {
                                        "constant_value": "us-south"
                                    },
                                    "resource_instance_id": {
                                        "references": [
                                            "var.cos_instance_id"
                                        ]
                                    },
                                    "storage_class": {
                                        "constant_value": "standard"
                                    }
                                },
                                "schema_version": 0,
                                "count_expression": {
                                    "constant_value": 2
                                }
                            }
                        ],
                        "variables": {
                            "cos_instance_id": {
                                "description": "COS Instance ID"
                            }
                        }
                    },
                    "depends_on": [
                        "module.instance"
                    ]
                }
            }
        }
    }
}
```


#### Example profile file for the `terraform-validate` command
{: #terraform-example-profile}

```text
{
    "scc_goals": [
        {
            "scc_goal_id": "3000001"
        },
        {
            "scc_goal_id": "3000002"
        },
        {
            "scc_goal_id": "3000003"
        },
        {
            "scc_goal_id": "3000004"
        }
    ],
    "scc_goal_parameters": {
        "no_of_managers_for_cloudant_db": 4
    },
    "rego_rules": [
        {
            "rule_name": "vpc_sec_group_attached"
        }
    ]
}
```

### {{site.data.keyword.compliance_short}} goals
{: #terraform-scc-goals}

The Terraform Analyzer supports the following {{site.data.keyword.compliance_short}} goals:

```text
3000001 - Ensure IBMid password policy requires at least one uppercase letter
3000002 - Ensure IBMid password policy requires at least one lowercase letter
3000003 - Ensure IBMid password policy requires at least one number
3000004 - Ensure IBMid password policy requires minimum length of 12 characters
3000005 - Ensure IBMid password policy prevents password reuse below the minimum of #
3000006 - Ensure IBMid password contains only printable ASCII characters (in the range 33 - 126)
3000007 - Ensure IBMid password password doesn't contain spaces or any of following characters: ;:(?)<>"
3000008 - Ensure the usage of a password meter that coaches users to create stronger passwords
3000009 - Ensure IAM roles are used to create IAM policies for IBM resources
3000010 - Ensure a support role has been assigned in IAM to manage cases in the IBM Cloud Support Center
3000011 - Ensure that IBM Cloud API keys are not created during the initial setup of IAM users
3000015 - Ensure IAM users are attached to access groups
3000016 - Ensure IAM policies for users are attached only to groups or roles
3000030 - Ensure IAM policies for service IDs are attached only to groups or roles
3000017 - Ensure multifactor authentication (MFA) is enabled at the account level
3000021 - Ensure there are no more than # IAM administrators configured per account
3000027 - Ensure permissions for API key creation are limited and configured in IAM settings
3000022 - Ensure Cloud Object Storage public access is disabled in IAM settings (not applicable to ACLs managed using S3 APIs)
3000028 - Ensure permissions for service ID creation are limited and configured in IAM settings
3000029 - Ensure IAM-enabled services have no more than # users with the IAM administrator role
3000031 - Check whether Identity and Access Management (IAM) is enabled with audit logging
3000032 - Ensure IAM-enabled services have no more than # service IDs with the IAM administrator role
3000033 - Ensure IAM-enabled services have at least # users with the IAM manager role
3000038 - Check whether account has no more than # service IDs with admin privileges
3000034 - Ensure IAM-enabled services have at least # service IDs with the IAM manager role
3000035 - Ensure account access is managed only by IAM access groups
3000101 - Ensure Cloud Object Storage is enabled with encryption
3000102 - Ensure Cloud Object Storage is enabled with customer-managed encryption and Bring Your Own Key (BYOK)
3000229 - Ensure Certificate Manager certificates that are generated by the service are renewed automatically before they expire
3000103 - Check whether Cloud Object Storage is accessible only through HTTPS
3000104 - Ensure Cloudant is accessible only through HTTPS
3000105 - Ensure Cloud Object Storage is accessible only through private endpoints
3000106 - Ensure Cloud Object Storage bucket access is restricted by using IAM and S3 access control
3000107 - Ensure Cloud Object Storage network access is restricted to a specific IP range
3000108 - Ensure Cloud Object Storage is enabled with customer-managed encryption and Keep Your Own Key (KYOK)
3000201 - Ensure Databases for MongoDB is enabled with encryption
3000202 - Ensure Databases for MongoDB is enabled with customer-managed encryption and Bring Your Own Key (BYOK)
3000203 - Ensure Databases for MongoDB is accessible only through HTTPS
3000204 - Ensure Databases for MongoDB is accessible only through private endpoints
3000206 - Ensure Databases for Redis is enabled with encryption
3000207 - Ensure Databases for Redis is enabled with customer-managed encryption and Bring Your Own Key (BYOK)
3000208 - Ensure Databases for Redis is accessible only through HTTPS
3000209 - Ensure Databases for Redis is accessible only through private endpoints
3000211 - Ensure Databases for Elasticsearch encryption is enabled
3000212 - Ensure Databases for Elasticsearch encryption is enabled with BYOK
3000213 - Ensure Databases for Elasticsearch is accessible only through HTTPS
3000214 - Ensure Databases for Elasticsearch is accessible only through private endpoints
3000216 - Ensure Databases for etcd is enabled with encryption
3000217 - Ensure Databases for etcd is enabled with customer-managed encryption and Bring Your Own Key (BYOK)
3000218 - Ensure Databases for etcd is accessible only through HTTPS
3000219 - Ensure Databases for etcd is accessible only through private endpoints
3000221 - Ensure Databases for PostgreSQL is enabled with encryption
3000222 - Ensure Databases for PostgreSQL is enabled with customer-managed encryption and Bring Your Own Key (BYOK)
3000223 - Ensure Databases for PostgreSQL is accessible only through HTTPS
3000224 - Ensure Databases for PostgreSQL is accessible only through private endpoints
3000205 - Ensure network access for MongoDB is restricted to specific IP range
3000210 - Ensure Databases for Redis network access is restricted to specific IP range
3000215 - Ensure Databases for Elasticsearch network access is restricted to a specific IP range
3000220 - Ensure Databases for etcd network access is restricted to a specific IP range
3000225 - Ensure Databases for PostgreSQL network access is restricted to a specific IP range
3000231 - Ensure Key Protect has high availability
3000232 - Ensure Kubernetes Service is configured with role-based access control (RBAC)
3000233 - Ensure Hyper Protect Crypto Services instance has at least # crypto units
3000234 - Ensure Hyper Protect Crypto Services instance is enabled with a dual authorization deletion policy
3000235 - Check whether Hyper Protect Crypto Services encryption keys that are generated by the service are rotated automatically at least every # months
3000240 - Check whether Bare Metal Servers are ordered with redundant power supplies to ensure workload protection
3000242 - Ensure Databases for Redis has no more than # users with the IAM administrator role
3000243 - Ensure Databases for PostreSQL has no more than # users with the IAM administrator role
3000244 - Ensure Databases for MongoDB has no more than # users with the IAM administrator
3000245 - Ensure Databases for Elasticsearch has no more than # users with the IAM administrator role
3000109 - Ensure Databases for Cloudant has no more than # users with the IAM administrator role
3000247 - Ensure Key Protect has no more than # users with the IAM administrator role
3000246 - Ensure Databases for etcd has no more than # users with the IAM administrator role
3000248 - Ensure Kubernetes Service has no more than # users with the IAM administrator role
3000249 - Ensure Databases for EnterpriseDB has no more than # users with the IAM administrator role
3000251 - Ensure Databases for Elasticsearch has no more than # service IDs with the IAM administrator role
3000252 - Ensure Key Protect has no more than # service IDs with the IAM administrator role
3000253 - Ensure Databases for etcd has no more than # service IDs with the IAM administrator role
3000254 - Ensure Kubernetes Service has no more than # service IDs with the IAM administrator role
3000255 - Ensure Databases for EnterpriseDB has no more than # service IDs with the IAM administrator role
3000312 - Ensure Databases for MongoDB has no more than # service IDs with the IAM administrator role
3000313 - Ensure Databases for Redis has no more than # service IDs with the IAM administrator role
3000314 - Ensure Databases for PostgreSQL has no more than # service IDs with the IAM administrator role
3000110 - Ensure Cloudant has no more than # service IDs with the IAM administrator role
3000111 - Ensure Cloudant has at least # users with the IAM manager role
3000112 - Ensure Cloudant has at least # service IDs with the IAM manager role
3000256 - Ensure App ID has at least # users with the IAM manager role
3000257 - Ensure App ID has at least # service IDs with the IAM manager role
3000258 - Ensure Cloud Object Storage has at least # users with the IAM manager role
3000259 - Ensure Cloud Object Storage has at least # service IDs with the IAM manager role
3000260 - Ensure Event Streams has at least # users with the IAM manager role
3000261 - Ensure Event Streams has at least # service IDs with the IAM manager role
3000262 - Ensure schematics has at least # users with the IAM manager role
3000263 - Ensure schematics has at least # service IDs with the IAM manager role
3000264 - Ensure Transit Gateway has at least # users with the IAM manager role
3000265 - Ensure Transit Gateway has at least # service IDs with the IAM manager role
3000266 - Ensure Key Protect has at least # users with the IAM manager role
3000267 - Ensure Key Protect has at least # service IDs with the IAM manager role
3000268 - Ensure Kubernetes Service has at least # users with the IAM manager role
3000269 - Ensure Kubernetes Service has at least # service IDs with the IAM manager role
3000270 - Ensure Certificate Manager has at least # users with the IAM manager role
3000271 - Ensure Certificate Manager has at least # service IDs with the IAM manager role
3000113 - Ensure Cloudant access is managed only by IAM access groups
3000272 - Ensure Databases for Redis access is managed only by IAM access groups
3000273 - Ensure Databases for PostgreSQL access is managed only by IAM access groups
3000274 - Ensure Databases for MongoDB access is managed only by IAM access groups
3000275 - Ensure Databases for Elasticsearch access is managed only by IAM access groups
3000276 - Ensure Databases for etcd access is managed only by IAM access groups
3000277 - Ensure Key Protect access is managed only by IAM access groups
3000278 - Ensure Kubernetes Service access is managed only by IAM access groups
3000279 - Ensure Databases for EnterpriseDB access is managed only by IAM access groups
3000114 - Ensure Cloud Object Storage buckets are enabled with IBM Activity Tracker
3000115 - Ensure Cloud Object Storage buckets are enabled with IBM Cloud Monitoring
3000116 - Ensure Cloud Object Storage bucket resiliency is set to cross region
3000301 - Ensure IBM Activity Tracker is provisioned in multiple regions in an account
3000302 - Ensure IBM Activity Tracker trails are integrated with LogDNA logs
3000303 - Ensure IBM Activity Tracker logs are encrypted at rest
3000304 - Ensure IBM Cloud Monitoring has no more than # users with the IAM administor role
3000308 - Ensure IBM Activity Tracker has no more than # users with the IAM administrator role
3000309 - Ensure IBM Activity Tracker has no more than # service IDs with the IAM administrator role
3000310 - Ensure IBM Cloud Monitoring has no more than # service IDs with the IAM administrator role
3000315 - Ensure IBM Cloud Internet Services (CIS) has at least # users with the IAM manager role
3000316 - Ensure IBM Cloud Internet Services (CIS) has at least # service IDs with the IAM manager role
3000317 - Ensure IBM Activity Tracker has at least # users with the IAM manager role
3000318 - Ensure IBM Activity Tracker has at least # service IDs with the IAM manager role
3000319 - Ensure IBM Cloud Monitoring access is managed only by IAM access groups
3000320 - Ensure IBM Activity Tracker access is managed only by IAM access groups
3000401 - Ensure Cloud Internet Services (CIS) has web application firewall enabled
3000402 - Ensure Cloud Internet Services (CIS) has DDoS protection enabled
3000403 - Ensure Cloud Internet Services (CIS) has TLS v1.2 set for all inbound traffic
3000404 - Ensure Virtual Private Cloud (VPC) security groups have no inbound rules that specify source IP 0.0.0.0/0 to SSH port 22
3000405 - Ensure Virtual Private Cloud (VPC) security groups have no inbound rules that specify source IP 0.0.0.0/0 to RDP ports 3389
3000406 - Ensure Virtual Private Cloud (VPC) has no rules in the default security group
3000408 - Ensure Flow Logs for VPC are enabled
3000410 - Ensure Virtual Private Cloud (VPC) security groups have no inbound ports open to the internet (0.0.0.0/0)
3000411 - Ensure Virtual Private Cloud (VPC) security groups have no outbound ports open to the internet (0.0.0.0/0)
3000412 - Ensure all virtual server instances have at least one Virtual Private Cloud (VPC) security group attached
3000413 - Ensure all network interfaces of a virtual server instance have at least one Virtual Private Cloud (VPC) security group attached
3000418 - Ensure account is configured with at least one VPN
3000419 - Ensure VPN for VPC has Internet Key Exchange (IKE) policy encryption that is not set to 'triple_des'
3000420 - Ensure VPN for VPC has Internet Key Exchange (IKE) policy authentication that is set to 'sha256'
3000421 - Ensure VPN for VPC has a Diffie-Hellman group set to at least group #
3000422 - Ensure VPN for VPC has IPsec policy encryption that is not set to 'triple_des'
3000423 - Ensure VPN for VPC has IPsec policy authentication that is set to 'sha256'
3000424 - Ensure VPN for VPC has an IPsec policy that does not have Perfect Forward Secrecy (PFS) disabled
3000425 - Ensure VPN for VPC authentication is configured with a strong pre-shared key with at least 24 alphanumeric characters
3000426 - Ensure VPN for VPC has a Dead Peer Detection policy that is set to 'restart'
3000427 - Ensure Application Load Balancer for VPC has public access disabled
3000428 - Ensure Application Load Balancer for VPC is configured with multiple members in the pool
3000429 - Ensure Application Load Balancer for VPC listener is configured with default pool
3000430 - Ensure Application Load Balancer for VPC has health check configured when created
3000431 - Ensure Application Load Balancer for VPC has a health check protocol that is either HTTP or HTTPS
3000432 - Ensure Application Load Balancer for VPC pool uses the HTTPS protocol for HTTPS listeners
3000433 - Ensure Application Load Balancer for VPC is configured to convert HTTP client requests to HTTPS
3000434 - Ensure Application Load Balancer for VPC uses HTTPS (SSL & TLS) instead of HTTP
3000436 - Check whether Block Storage for VPC is enabled with customer-managed encryption and Bring Your Own Key (BYOK)
3000437 - Check whether Block Storage for VPC is enabled with customer-managed encryption and Keep Your Own Key (KYOK)
3000439 - Check whether data disks are encrypted with customer-managed keys
3000440 - Check whether unattached disks are encrypted with customer-managed keys
3000444 - Ensure Security Groups for VPC contains no outbound rules in security groups that specify source IP 8.8.8.8/32 to DNS port 53
3000446 - Ensure Security Groups for VPC doesn't allow PING for the default security group
3000447 - Ensure Virtual Private Cloud (VPC) classic access is disabled
3000449 - Ensure Virtual Private Cloud (VPC) has no public gateways attached
3000451 - Ensure Virtual Private Cloud (VPC) network access control lists don't allow ingress from 0.0.0.0/0 to any port
3000441 - Ensure Virtual Private Cloud (VPC) network access control lists don't allow ingress from 0.0.0.0/0 to port 22
3000442 - Ensure Virtual Private Cloud (VPC) network access control lists don't allow ingress from 0.0.0.0/0 to port 3389
3000452 - Ensure Virtual Private Cloud (VPC) network access control lists don't allow egress from 0.0.0.0/0 to any port
3000453 - Ensure Virtual Servers for VPC instance has the minimum # interfaces
3000454 - Ensure Virtual Servers for VPC instance doesn't have a floating IP
3000455 - Ensure Virtual Servers for VPC instance has all interfaces with IP-spoofing disabled
3000456 - Ensure Virtual Servers for VPC resource group other than Default is selected
3000457 - Ensure Virtual Servers for VPC boot volumes are enabled with customer-managed encryption and Bring Your Own Key (BYOK)
3000458 - Ensure Virtual Servers for VPC boot volumes are enabled with customer-managed encryption and Keep Your Own Key (KYOK)
3000459 - Ensure Virtual Servers for VPC data volumes are enabled with customer-managed encryption and Bring Your Own Key (BYOK)
3000460 - Ensure Virtual Servers for VPC data volumes are enabled with customer-managed encryption and Keep Your Own Key (KYOK)
3000461 - Ensure Virtual Servers for VPC is provisioned from an encrypted image
3000462 - Ensure Virtual Servers for VPC is provisioned from customer-defined list of images
3000463 - Ensure Virtual Servers for VPC instances are identifable by the workload they are running based on the Auto Scale for VPC instance group definition
3000464 - Ensure Application Load Balancer for VPC has application port of the workload that is identifiable by the Auto Scale for VPC instance group definition
3000467 - Ensure Virtual Private Cloud (VPC) has no subnet with public gateway attached
3000469 - Ensure Application Load Balancer for VPC is configured with at least one VPC security group
3000623 - Ensure Container Registry has no more than # users with the IAM administrator role
3000628 - Ensure Container Registry has no more than # service IDs with the IAM administrator role
3000635 - Ensure Container Registry has at least # users with the IAM manager role
3000636 - Ensure Container Registry has at least # service IDs with the IAM manager role
3000639 - Ensure Container Registry access is managed only by IAM access groups
3000622 - Ensure Continuous Delivery has no more than # users with the IAM administrator role
3000629 - Ensure Continuous Delivery has no more than # service IDs with the IAM administrator role
3000633 - Ensure Continuous Delivery has at least # users with the IAM manager role
3000634 - Ensure Continuous Delivery has at least # service IDs with the IAM manager role
3000638 - Ensure Continuous Delivery access is managed only by IAM access groups
3000621 - Ensure Secrets Manager has no more than # users with the IAM administrator role
3000630 - Ensure Secrets Manager has no more than # service IDs with the IAM administrator role
3000631 - Ensure Secrets Manager has at least # users with the IAM manager role
3000632 - Ensure Secrets Manager has at least # service IDs with the IAM manager role
3000637 - Ensure Secrets Manager access is managed only by IAM access groups
3000706 - Ensure App ID user data is encrypted
3000305 - Ensure Event Streams is accessible through public endpoints
3000306 - Ensure Event Streams is accessible only through private endpoints
3000307 - Ensure Event Streams network access is restricted to a specific IP range
3000802 - Ensure Kubernetes Service is accessible only by using private endpoints
3000804 - Ensure Kubernetes Service clusters are enabled with IBM Cloud Monitoring
3000805 - Ensure Kubernetes Service clusters are enabled with IBM Log Analysis
3000902 - Ensure OpenShift clusters are accessible only by using private endpoints
3000907 - Check whether OpenShift version is up-to-date
```

## Using Code Risk Analyzer in Tekton pipelines
{: #cra-tekton-pipelines}

You can use the [`task-cra`](https://github.com/open-toolchain/tekton-catalog/tree/master/cra#cra){: external} task in Tekton pipelines. Use the [Tekton pipeline definition](https://github.com/open-toolchain/tekton-catalog/tree/master/cra/sample-v2){: external} when you create a pull request, a manual trigger, or issue a commit. You can also create your own Tekton tasks and run the Code Risk Analyzer from those tasks.

## Using Code Risk Analyzer in DevSecOps
{: #cra-devsecops}

You can use Code Risk Analyzer in [DevSecOps](/docs/devsecops?topic=devsecops-devsecops_intro). The following table lists and describes the supported Code Risk Analyzer parameters for DevSecOps.

For more information about the dependent utility commands that are required by the pipeline image to run the `bom-generate` command, see [BOM requirements](#bom-requirements). If commands are missing, you can use the `cra-custom-script-path` parameter to reference a script to install those commands.
{: tip}


|Name |Type	|Description |Required or Optional |
|:----------|:------------------------------|:------------------|:----------|
|artifactory-dockerconfigjson 		|SECRET 		|The base64-encoded Docker `config.json` file that stores credential information for Artifactory.	 			|Optional			|
|baseimage-auth-user		|text		|The credentials for the base image of the application Dockerfile that is required by the Code Risk Analyzer scan.			|Optional			|
|baseimage-auth-email		|text 		|The credentials for the base image of the application Dockerfile that is required by the Code Risk Analyzer scan.		|Optional			|
|baseimage-auth-host		|text		|The credentials for the base image of the application Dockerfile that is required by the Code Risk Analyzer scan.	|Optional			|
|baseimage-auth-password		|SECRET		|The credentials for the base image of the application Dockerfile that is required by the Code Risk Analyzer scan. |Optional			|
|cra-cveignore-path             |text   |The path to the `cveignore` file that is relative to the root of the application repo. The default file path is `.cra/.cveignore`.   |Optional    | 
| cra-custom-script-path  | text   | The path to a custom script that runs before Code Risk Analyzer scanning. This script is sourced to provide the option to set `ENV` variables in the context of the Code Risk Analyzer BOM tool. | Optional |
|cra-docker-buildflags          |text   |The custom Docker build command for build stage scanning. This parameter is empty by default.    |Optional    |
|cra-docker-build-context        | text  |If specified, Code Risk Analyzer uses the directory in the path parameter as the Docker build context.        |Optional    |
|cra-exclude-devdependencies		|text		|Specifies whether to exclude dev dependencies from scanning (`true` or `false`). The default value is `false`.	|Optional			|
|cra-gradle-exclude-configs     |text   |Specifies which Gradle configurations to exclude dependencies from in scanning. For example, `runtimeClasspath,testCompileClasspath`. This parameter is empty by default.   |Optional   |
|cra-maven-exclude-scopes       |text   |Specifies which Maven scopes to exclude dependencies from in scanning. For example, `test,compile`. This parameter is empty by default.  |Optional   |
|cra-nodejs-create-package-lock		|text		|Enables Code Risk Analyzer discovery to build the `package-lock.json` file for node.js repos. This parameter is set to `false` by default.	|Optional			|
|ibmcloud-api-key		|SECRET		|The {{site.data.keyword.cloud}} API key that interacts with the `ibmcloud` CLI tool.	|Required			|
|pipeline-dockerconfigjson		|SECRET		|The base64-encoded Docker `config.json` file that pulls images from a private registry.	|Optional			|
|onepipeline-dockerconfigjson		|SECRET		|Deprecated. The base64-encoded Docker `config.json` file that pulls images from a private registry.	|Optional			|
|pipeline-debug		|select		|The pipeline debug mode switch.	|Optional			|
{: caption="Table 7. DevSecOps Code Risk Analyzer-based parameters" caption-side="top"}

### Example custom scripts for DevSecOps
{: #devsecops-custom-script-examples}

If your Dockerfile requires ARGS, you can use the `cra-custom-script-path` parameter to set an individual ARG as an environment variable before you run the command. The custom script path is the path to a script that resides in the user's project. For example, if the Dockerfile uses `IAM_USER ARG`, export an environment variable inside the script that is named `IAM_USER: export IAM_USER='value'`. If the ARG that is required by your Dockerfile is set as an environment property within toolchains, you can use `get_env` to get the value. In this instance, you can export an environment variable within the `IAM_USER: export IAM_USER=$(get_env iam_user_environment_property_name)` script.  The `run-cra` task automatically picks up these environment variables and passes them to the Docker build commands.

The following example shows how to use the `cra-custom-script` to export the `ENV` variable:

```bash
#!/usr/bin/env bash

if [[ "${PIPELINE_DEBUG:-0}" == 1 ]]; then
    trap env EXIT
    env | sort
    set -x
fi

export IAM_USER=$(get_env iam_user_environment_property_name)
```

You can also use the `cra-custom-script-path` parameter for scenarios in which the DevSecOps base image tool versions might be outdated, based on your project. For example, you can update commands such as `pip/pip3` for discovering Python packages that require a later pip version. 

The following example shows how to use the `cra-custom-script` to update the pip version:

```bash
#!/usr/bin/env bash

if [[ "${PIPELINE_DEBUG:-0}" == 1 ]]; then
    trap env EXIT
    env | sort
    set -x
fi

python3 -m pip install --upgrade pip
```

If your Dockerfile uses an image from a private Docker registry, you can use the `cra-custom-script-path` parameter to authenticate to a private Docker registry before you run Code Risk Analyzer and to allow Code Risk Analyzer to pull this image for scanning. 

The following example shows how to use the `cra-custom-script` to authenticate to the `ibmcloud` container registry:

```bash
#!/usr/bin/env bash

if [[ "${PIPELINE_DEBUG:-0}" == 1 ]]; then
    trap env EXIT
    env | sort
    set -x
fi

ibmcloud cr login
```

### Debugging the Code Risk Analyzer in DevSecOps
{: #debugging-cra-devsecops}

To help with debugging, you can run the Code Risk Analyzer locally as a command-line interface (CLI) on your own local machine. For information about running the `ibmcloud cra bom-generate` command to generate a BOM file, see [Bill of Materials (BOM)](#bom-generate-command). After you generate the BOM file, use the `ibmcloud cra cve` command to list any vulnerabilities. For more information about running the `ibmcloud cra cve` command, see [Vulnerability scan](#vulnerability-command).

Make sure that the `run-cra` task does not contain any errors. If the task contains errors, check whether your pipeline uses the current version of DevSecOps. If the issue is not resolved by checking the version of DevSecOps, the following examples provide some common errors and proposed solutions.

```text
FAILED
Error executing docker pull cmd: [docker pull us.icr.io/opentoolchain/ibmnode:14ubisecure]
```

You can verify that you have access to the private registry. If you do not have access, you can use the `cra-custom-script-path` parameter and specify the path to a custom script that runs before Code Risk Analyzer to authenticate to the private registry. 

```text
FAILED
Error executing docker build cmd for stage-0: exit status 1
```

If your Dockerfile requires ARGS, the `docker build` command for the build stages fails to build because of the missing ARGS. The `cra-custom-script-path` is required to set up the ARGS as environment variables. For more information about setting up the custom script, see [Example custom scripts for DevSecOps](#devsecops-custom-script-examples).

```text
FAILED
Error executing docker build cmd for stage-0: exit status 1
...
COPY file-to-copy.js file-to-copy.js:
------
failed to compute cache key: "/file-to-copy.js" not found: not found
```

By default, the Code Risk Analyzer `bom-generate` command builds the Dockerfiles from the context of the location of the Dockerfile itself. If you want to build the Dockerfiles from the context of the root project directory, use the `cra-docker-build-context` parameter to allow the Code Risk Analyzer to build the Dockerfiles from this context.

## Removing stored Code Risk Analyzer data
{: #cra-remove-data}

The Code Risk Analyzer plug-in does not store any client data in its databases. However, earlier versions of Code Risk Analyzer Tekton tasks securely stored the results of vulnerability scans in its database.

To request the removal of any client data that might be stored in the Code Risk Analyzer, contact [IBM Support](https://cloud.ibm.com/unifiedsupport/supportcenter){: external}.

## FAQs
{: #faq}

Get answers to frequently asked questions about using the Code Risk Analyzer CLI.

### How can I determine why the CLI failed?
{: #faq-cli-failure}
 
Before you call the Code Risk Analyzer CLI, set the `IBMCLOUD_TRACE` environment variable to true to turn on the debug log.

```sh
export IBMCLOUD_TRACE=true
```

Observe the API calls and the responses that are shown in the log to determine the exact reason for failure.

### How can I debug a BOM command that fails to pull a base image from a private registry.
{: #faq-bom-failure}

Make sure that you are authenticated with the registry where the base image resides by using the `ibmcloud cr login` command or the `docker login` command.

### How can I debug a BOM command that is failing to analyze a Dockerfile?
{: #faq-bom-debug}

* Verify that the Dockerfile does not have any issues by running the  `docker build` command and making sure that it passes.  
* If your Dockerfile requires ARG to be passed, make sure that the ARG is set as an environment variable. You can also use the `DOCKERBUILDFLAG` environment variable.
* Authenticate with the registry that contains the base images.
